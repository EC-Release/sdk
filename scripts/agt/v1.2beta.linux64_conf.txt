#!/bin/bash

mkdir -p ~/.ec/agt/bin

# tbc add more conf files

AGENT_REV_LOCAL=$AGENT_REV
if [[ $AGENT_REV_LOCAL != "1.2-b."* ]]; then
  AGENT_REV_LOCAL=1.2-b
  #for dev
  if [[ -z "$EC_DEV" ]]; then
    [[ -f ~/.ec/agt/bin/$AGENT_REV_LOCAL ]] && rm ~/.ec/agt/bin/$AGENT_REV_LOCAL
    [[ -f ~/.ec/agt.tar.gz ]] && rm ~/.ec/agt.tar.gz

    wget -q -O ~/.ec/agt.tar.gz https://raw.githubusercontent.com/EC-Release/sdk/disty/agt.tar.gz
    tar xvf ~/.ec/agt.tar.gz -C ~/.ec/agt/bin/ > /dev/null && rm ~/.ec/agt.tar.gz
    
    wget -q -O ~/.ec/agt/bin/1.2-dev https://raw.githubusercontent.com/EC-Release/sdk/disty/1.2-dev
  fi
else
  wget -q -O ~/.ec/tengu_linux_sys.tar.gz https://raw.githubusercontent.com/EC-Release/tengu/${AGENT_REV_LOCAL}/dist/tengu/tengu_linux_sys.tar.gz
  tar xvf ~/.ec/tengu_linux_sys.tar.gz -C ~/.ec/agt/bin/ > /dev/null && rm ~/.ec/tengu_linux_sys.tar.gz > /dev/null
  mv ~/.ec/agt/bin/tengu_linux_sys ~/.ec/agt/bin/${AGENT_REV_LOCAL}
fi

chmod +x ~/.ec/agt/bin/${AGENT_REV_LOCAL} > /dev/null

ln -s ~/.ec/agt/bin/${AGENT_REV_LOCAL} /usr/local/bin/agent
ln -s ~/.ec/agt/bin/${AGENT_REV_LOCAL} /usr/local/bin/agt
ln -s ~/.ec/agt/bin/${AGENT_REV_LOCAL} /usr/local/bin/sdc
ln -s ~/.ec/agt/bin/${AGENT_REV_LOCAL} /usr/local/bin/sdr
ln -s ~/.ec/agt/bin/${AGENT_REV_LOCAL} /usr/local/bin/sac
ln -s ~/.ec/agt/bin/${AGENT_REV_LOCAL} /usr/local/bin/svc

chmod +x ~/.ec/agt/bin/1.2-dev > /dev/null
ln -s ~/.ec/agt/bin/1.2-dev /usr/local/bin/dev
#ln -s ~/.ec/agt/bin/1.2-dev /usr/local/bin/svc
#ln -s ~/.ec/agt/bin/1.2-dev /usr/local/bin/sac

source <(wget -q -O - https://raw.githubusercontent.com/EC-Release/sdk/disty/scripts/agt/conf/agent_v1.2beta.sh) "$@"
