#!/bin/bash
mkdir -p ~/.ec/agt/conf ~/.ec/agt/bin
#chmod 755 ~/.ec/agt/conf/agent_v1.2.sh

# tbc add more conf files

rm ~/.ec/agent &> /dev/null

# default if AGENT_REV is present in env
AGENT_REV_LOCAL=$AGENT_REV
if [[ $AGENT_REV_LOCAL != "1.2-rc."* ]]; then
  AGENT_REV_LOCAL=1.2-rc.0.reiwa
fi

wget -q -O ~/.ec/tengu_linux_sys.tar.gz https://raw.githubusercontent.com/EC-Release/tengu/${AGENT_REV_LOCAL}/dist/tengu/tengu_linux_sys.tar.gz &> /dev/null
tar xvf ~/.ec/tengu_linux_sys.tar.gz -C ~/.ec/agt/bin/ &> /dev/null && rm ~/.ec/tengu_linux_sys.tar.gz
mv "$HOME/.ec/agt/bin/tengu_linux_sys" "$HOME/.ec/agt/bin/$AGENT_REV_LOCAL"

chmod +x "$HOME/.ec/agt/bin/$AGENT_REV_LOCAL"

ln -s "$HOME/.ec/agt/bin/$AGENT_REV_LOCAL" /usr/local/bin/agent
ln -s "$HOME/.ec/agt/bin/$AGENT_REV_LOCAL" /usr/local/bin/agt

export PATH=$PATH:$HOME/.ec
source <(wget -q -O - https://raw.githubusercontent.com/EC-Release/sdk/disty/scripts/agt/conf/agent_v1.2.sh) "$@"
