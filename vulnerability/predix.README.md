## Secruity Vulnerability Items

#### Contents
* [Prologue](#prologue) 
* [Business Resources](#business-resources) 
* [Author](#author)
* [Research Standards](#research-standards)
* [Findings vs. Feedback](#findings-vs-feedback)
    * [Report Item 3699](#report-3699)
    * [Report Item 3700, 3701](#report-3700-3701)
    * [Report Item 3702](#report-3702)
    * [Report Item 3703](#report-3703)
    * [Report Item 3704](#report-3704)
      
      
#### Prologue
In July '20, GE Digital (Predix) was retained to conduct an internal evaluation over the current production agent (v1) and service (1.0). The evaluation was mainly focused on the network security practice up to HTTP level. EC @R&D had put up an action plan and executing it accordingly. The detail is as follows.

#### Business Resources
- [Project board](https://github.com/Release/sdk/projects/18)
- [The codebase](https://gitlab.com/digital-fo/connectivity/enterprise-connect/platform-agnostic/agent/-/tree/v1_sourcecode_update_pentest)
- [Original draft (Internal)](https://ge.ent.box.com/file/694822011858)
- [Stakeholders](https://github.com/orgs/Enterprise-connect/teams/ec-stakeholders)

#### Author
 - [Research & Develoment @EC](https://github.com/orgs/EC-Release/teams/research-development)

#### Research Standards
 - [HTTP/1.1 (RFC-2616)](https://tools.ietf.org/html/rfc2616)
 - [HTTP Message Syntax and Routing (RFC-7230)](https://tools.ietf.org/html/rfc7230)

#### Findings vs. Feedback
##### Report 3699
  - The vulnerability ([3699](https://github.com/EC-Release/sdk/issues/125)) on EC configruation during the HTTP call is acknowledged. We are proposing an encryption library ([code snippet](https://gitlab.com/digital-fo/connectivity/enterprise-connect/platform-agnostic/agent/-/blob/v1_sourcecode_update_pentest/pentest.go#L10)) as part of new cipher procedure during the call.
  - Upon an internal review, the security library will be intruduced in the next agent release (v1.hokkaido.213)
  - **Interim remediation action**: To well preventing similar attacks, EC pro-subscribers should be cautious on adopting a range of applicable httpproxy services, or/and avoiding using third-party http proxy services in applicable use cases.
  - Digital Redteam recommendation: Service path should be sanitised.
  - **Release update [11-11-2020]**: feature (URL/URL refactoring) added in the release candidate [v1beta.fukuoka.1727](https://github.com/EC-Release/sdk/releases/tag/v1beta.fukuoka.1727) as a security enhancement. The feature applied to all service-related calls.([code snippet](https://gitlab.com/digital-fo/connectivity/enterprise-connect/platform-agnostic/agent/-/blob/v1_sourcecode_update_pentest/wzlib/wzutil/wzutil.go#L660)) E.g [usage reporting](https://gitlab.com/digital-fo/connectivity/enterprise-connect/platform-agnostic/agent/-/blob/v1_sourcecode_update_pentest/wzlib/wzconf/wzconf.go#L1459), [token validation](https://gitlab.com/digital-fo/connectivity/enterprise-connect/platform-agnostic/agent/-/blob/v1_sourcecode_update_pentest/wzlib/wzconf/wzconf.go#L1533), [group validation](https://gitlab.com/digital-fo/connectivity/enterprise-connect/platform-agnostic/agent/-/blob/v1_sourcecode_update_pentest/wzlib/wzconf/wzconf.go#L1576), [cert downloading](https://gitlab.com/digital-fo/connectivity/enterprise-connect/platform-agnostic/agent/-/blob/v1_sourcecode_update_pentest/wzlib/wzconf/wzconf.go#L1639)
  
[Back to Contents](#contents)

##### Report 3700, 3701

   This vulnerability (refers to both [3700, 3701](https://github.com/EC-Release/sdk/issues/123)) suggested an auth-basis access to agent health HTTP endpoint(s). In order to avoid the vulnerability -
   - Health page should be accessible only after authentication via bearer token or admin token or admin secret.
   - EC should have inbuilt certificate mechanism to generate and verification
   - **Interim remediation action**: it is highly recommended to set the flag ```-shc``` in the agent configuration to enable the "Basic" authentication. [A code snippet for reference](https://gitlab.com/digital-fo/connectivity/enterprise-connect/platform-agnostic/agent/-/blob/v1.1beta/main.go#L173)
   - Digital Redteam recommendation: No objection.
   - **Release update [11-11-2020]**: Usage with flag ```-shc``` is being communicated to business users.
   

[Back to Contents](#contents)

##### Report 3702

   - This vulnerability ([3702](https://github.com/EC-Release/sdk/issues/122)) describes the EC service API response though agent sending wrong token or random string not encrypted with public key for validation
   - The cipher process to secure the random string by a EC certificate/pubkey is proven in the working state. In fact, if the certificate/pubkey used to encrypt such random string were to expire, it would raise an exception and resulting in ```404 Page not found``` as the http response. [The code snippet explains the process for reference](https://gitlab.com/digital-fo/connectivity/enterprise-connect/predix/ec-px-service/-/blob/v1beta/lib/api/reportingApi.js#L146). However, upon successful decryption, as result the ```200  response code``` does not include the random string originated by the gateway. Thus, we are updating [the response endpoint](https://gitlab.com/digital-fo/connectivity/enterprise-connect/predix/ec-px-service/-/blob/v1beta/lib/auth.js#L179) alongside the [the authentication module](https://gitlab.com/digital-fo/connectivity/enterprise-connect/predix/auth-api/-/blob/v1beta/main.go#L59) to mitigate the exception.
   - **Interim remediation action**: No immeidate action to be taken at subscription level since the x509 cipher process is in the working state.
   - Digital Redteam recommendation: No objection.
   - **Release update [11-11-2020]**: The service API has been re-worked and packaged in [the OCI spec](https://github.com/EC-Release/oci/blob/v1beta_svc_oci_spec/spec/service/Dockerfile). The [auth api](https://github.com/EC-Release/auth-api/blob/v1beta/main.go) has since been updated and is now a part of the service spec. Below the test screenshot for reference.
   
![cipher security #3702](https://ng-webui.herokuapp.com/v1.2beta/assets/images/cipher-screenshot.png)

[Back to Contents](#contents)

##### Report 3703

  - This vulenrability ([3703](https://github.com/EC-Release/sdk/issues/124)) states about the usage of file transfer flags in EC client, it suggests that this functionality may lead into getting access of file system on which EC server is running.
  - In order to avoid this vulnerability, it is recommended in the report to have more granular access control mechanism for file transfer operation using UAA scopes
  - The EC server side file system access should be limited by providing access to specific directory only with minimum user previledge ([code snippet](https://gitlab.com/digital-fo/connectivity/enterprise-connect/platform-agnostic/agent/-/blob/v1_sourcecode/wzlib/wzcore/client.go))
  - To simplify the usage in a context of a Predix environment, we are working to **disable the FT feature and/or its subsidiary feature(s)** to mitigate the vulnerability. However, we may contemplate a plan to publish a similar solution in future non-Predix release(s).
  - **Interim remediation action**: For linux-based usage, it is recommended NOT to launch the server agent binary with a sudoer privilege; for windows-based system, users should avoid executing the agent binary with the administrator role. For docker-based usage, users should consider [**running containers rootlessly**](https://docs.docker.com/engine/security/rootless/). The above precaution is taken in considering to restrict attackers' file access in the system, and discouraging similar attacks of sort.
   - Digital Redteam recommendation: No objection.
   - **Release update [11-11-2020]**: The feature (file transfer) removed from the release candidate [v1beta.fukuoka.1727](https://github.com/EC-Release/sdk/releases/tag/v1beta.fukuoka.1727).
  
[Back to Contents](#contents)

##### Report 3704

  - The item ([3704](https://github.com/EC-Release/sdk/issues/121)) found the usage of the loopback address vulnerable to an attack[1]. It also suggests that it is impractical to volunteerily trust any given proxy service[2].
  - [1]A request acceptance over a loopback address was designed for local test purpose. Propose to remove the exception in the current ipfiltering flow([code snippet](https://gitlab.com/digital-fo/connectivity/enterprise-connect/platform-agnostic/agent/-/blob/v1_sourcecode_update_pentest/wzlib/wzutil/ipfilter.go#L48)). A tester will then be required whitelist the loopback address at the gateway setting. This is a minimum business-impact item.
  - [2]In the suggestion of limiting the range of the proxy service, we found such limitation may discourage the service adoption, and further impose a maximum business impact due to an unknown httpproxy service setting applied to existing usage. Propose to add a custom flag(s) to restrict an acceptable range of proxy usage in the gateway setting.
  - **Interim remediation action**: In addition to the remediation action as suggested in Report Item 3699, EC subscribers should avoid adopting any proxy service that's classified as a IPv4/v6 loopback address.
  - Digital Redteam recommendation: No objection.
  - **Release update [11-11-2020]**: Proxy via a loopback interface is now restricted in the release candidate [v1beta.fukuoka.1727](https://github.com/EC-Release/sdk/releases/tag/v1beta.fukuoka.1727) ([code snippet](https://gitlab.com/digital-fo/connectivity/enterprise-connect/platform-agnostic/agent/-/blob/v1_sourcecode_update_pentest/wzlib/wzutil/ipfilter.go#L48)) and will be evaluated during the client request calls.

[Back to Contents](#contents)

<sup>draft ver: [v1.hokkaido.212.security.0](https://github.com/EC-Release/sdk/releases/tag/v1.hokkaido.212.security.0)</sup>
